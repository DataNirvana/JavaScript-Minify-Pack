<!-- https://github.com/evanw/packer -->
<html>
	<head>
		<link rel="shortcut icon" href="favicon.ico" />

		<script src="Packer.js" type="text/javascript"></script>

		<script type="text/javascript">

			function DoStep2() {
				let myIF = document.getElementById("Step1Frame");
                let myIFDoc = (myIF.contentWindow || myIF.contentDocument);
				if (myIFDoc.document) myIFDoc = myIFDoc.document;

				// Append the content
//				myIFDoc.getElementById("Input").value = document.getElementById("Input").value;

				// Run the form
                myIFDoc.forms[0].submit();

			}


			function DoPack() {

//                let myIF = document.getElementById("Step1Frame");
//                let myIFDoc = (myIF.contentWindow || myIF.contentDocument);
//                if (myIFDoc.document) myIFDoc = myIFDoc.document;

//				let contents = myIFDoc.body.content;

				/*let data = {
					"compilation_level": "SIMPLE_OPTIMIZATIONS",
					"output_format": "json",
					"output_info": "compiled_code",
					"js_code": document.getElementById("Input").value
				};*/

//                let data = new URLSearchParams(new FormData(document.forms[0]));
///////////////////////////////////////////////////////////////////////////////////

				//let theHeaders = { "Content-type": "application/x-www-form-urlencoded" };
//					'Content-Type': 'application/json',
//					'Access-Control-Allow-Origin': '*',
//					'Access-Control-Allow-Methods': 'GET, POST, PATCH, PUT, DELETE, OPTIONS',
//					'Access-Control-Allow-Headers': 'Origin, Content-Type, X-Auth-Token'
//				};

				//console.log(new Headers(), theHeaders);

/*				var xhr = new XMLHttpRequest();
				xhr.open("POST", "https://closure-compiler.appspot.com/compile", true);
				xhr.setRequestHeader('Content-Type', 'application/json');
				xhr.setRequestHeader('Access-Control-Allow-Origin', '*');

				xhr.setRequestHeader('Access-Control-Allow-Methods', 'GET, POST, PATCH, PUT, DELETE, OPTIONS');
				xhr.setRequestHeader('Access-Control-Allow-Headers', 'Origin, Content-Type, X-Auth-Token');

				xhr.onload = function() {
				  console.log("HELLO")
				  console.log(this.responseText);
				  var data = JSON.parse(this.responseText);
				  console.log(data);
				}
				xhr.send(JSON.stringify(data));
				*/

//				fetch('https://closure-compiler.appspot.com/compile', {
//					method: 'POST',
//					body: data
//				})
//					.then(response => {
//                        console.log(response);
						//response.json();
					//})
                    //.then(data => console.log(data));
/*
				fetch("https://closure-compiler.appspot.com/compile", {
				  method: "POST",
				  body: JSON.stringify(data),
//				  headers: new Headers()
                  headers: theHeaders
//				}).then(res => {
//				  console.log("Request complete! response:", res.js_code);
//				}).then(response => response.text())
				}).then(response => {

					console.log(response);

					response.json()
					}).then(function(data) {
				      	console.log(data);
				}).catch((err) => { console.log(err) });;

//console.log(document.getElementById("Input").value);
*/
				let output = packer.pack(document.getElementById("Input").value, true, true);
                //let output = packer.pack(contents, true, true);

				document.getElementById("Output").value = output;
			}


		</script>
	</head>
	<body>
		<form>
			<h2>Javascript minifier and packer</h2>
			Minifies javascript files by running the scripts through Google's <a href="https://closure-compiler.appspot.com/home">closure-compiler.appspot.com/home</a> to clean and minify them.
			This should result in smaller files which are then packed using Dean Edward's packer.  This should further reduce the file size and obfuscate the code.
			
			<h3>Step 1 - Minify</h3>
			<div>Add your code in the box below and <a href="javaScript: DoStep2();">DoStep1</a></div>

			<iframe id="Step1Frame" width="800" height="180" src="Step1.html"> </iframe>
			
			

			<h3>Step 2 - copy paste</h3>
			<div>Paste the output here</div>

			<textarea id="Input" name="js_code" type="text" rows="10" cols="100"></textarea>
			<div>Number of characters <span id="Char2">0</span></div>

			<h3>Step 3 - Pack</h3>
			<div><a href="javaScript: DoPack();">Pack it</a> and then collect your output here</div>
			<textarea id="Output" type="text" rows="10" cols="100"></textarea>
			<div>Number of characters <span id="Char3">0</span></div>
			<br><br>

			<input type="hidden" name="compilation_level" value="SIMPLE_OPTIMIZATIONS">
			<input type="hidden" name="output_format" value="text">
			<input type="hidden" name="output_info" value="compiled_code">



			<br /><br />


		</form>

		<script type="text/javascript">

			document.addEventListener("DOMContentLoaded", function () {

                let tb2 = document.getElementById("Input");
                tb2.onchange = function () {

                    document.getElementById("Char2").innerText = this.value.length;
                };

                let tb3 = document.getElementById("Output");
                tb3.onchange = function () {

                    document.getElementById("Char3").innerText = this.value.length;
                };

				            


            });


		</script>

	</body >
</html >